28-01-2020
----------

ЧТобы перезапустить jtag у элвиса надо:

закрыть программную среду програмирования
перезапустить службу джитага (через три кнопки)
запустить среду программирования

светодиод стоящий на сигнале TST1 нельзя испольщовать если порт работает как SPI,
в таком режиме можно использовать только LDAT[7:4]
A1_PWRDWN_3V3
CONTROL
IPWOFF
RST_1288


Ноги ftdi были перепутаны на мезанине!

//-----------
в режиме когда порт 2 и 3 сконфигурированы как SPI
нельзя использовать сигналы TST1 и TST2 !!!


06-12-2019
----------
проект:pj1_test_emitator_m54
Функция recvfrom в процедуре void UDP_work(int buf_size) - ожидает прихода данных, по этому если данных нет
всё висит в ней.
Чтобы шёл обмен надо всё время что-то в качестве квитанции отправлять.


20-11-2019
----------
Сделал в прошивку сброс LPORта после старта - вроде помогло с глюком при старте.
прошил прошивку в флеш.


15-11-2019
----------
Сейчас пытаюсь передавать сразу весь массив принятых данных - вперемешку 1 и 2 канал
и разбирать на компе, получается пока только 4096 отсчётов объеденённых передавать иначе каналы скачут между собой почему-то.
Предыдущий вариант проекта - лежит в папке "Комплект"

НЕ ПОЛУЧАЕТСЯ!!!
данные смещаются всё время на отсчёт в сторону.
эта проблема могла быть и раньше!!!

всё время забываю в коде мезанинной платы менять коэффициенты у обоих PLL!!!
при смене частоты REF.

поставили 100 Мгц генератор вместо 20 Мгц , начались проблемы - один канал (плохой 2 ) работает примерно так же
а первый канал (хороший) работает плохо - показывает кучу спур.
Проверка передачи тестовых данных показала что всё - ОК.
Подня уровень сигнала с генератора 100 Мгц стало лучше - работают оба канала , но картинки хуже по сравнению с генератором 20  МГЦ.

Сделали работу от внешнего генератора, картинка лучше но появились подвозбуды во всей полосе изредка , на низах шумов.
прошил прошивку во флешку.


31-10-2019
----------
с флешки не грузится из-за ресета
Сделал инициализацию 1288 как мастер, отключил его контакты SYNC
и делаю всё через SPI
Также сделал передачу 2048 сэмплов данных.

Вернул инициализацию слейв, но всё равно стартует не всегда.


25-10-2019
----------
Был маленький уровень сигнала на АЦп , поднял уровень
и пересчитал коэфф. передачи CIC фильтра.
Стало сильно лучше.

Второй канал:
поставили 6-дб аттенюатр между управляемым атт на входе и усилителем - стало лучше
в плане дин. диапазона!

23-10-2019
----------
Причины спуров в спектре АЦп:
1.нелинейности усилителей и смесителей
2.интермодуляционные составляющие
3.субгармоники тактовой частоты АЦП
4.нелинейность входных цепей АЦп!!!


Установив между каскадами усилителей трёхдецибельные
аттенюаторы - смогли добиться приличного вида характеристики для второго канала
а также добавив 0.01 Мкф конденсаторы по всем цепям АЦП.

Но у нас упал уровень сигнала перед АЦП.
Дин диапазон тока 65 Дб.
Надо добавить аттенюаторы в первый канал.


также мы вынесли из кабеля с тактовыми 100 Мгц для обоих АЦП , клоки 125 и 10 Мгц.
(подаём их отдельно)

21-10-2019
----------
В спектре тактовой 100Мгц были сигналы 125МГц и что-то ещё.
Что вызывало гармоники(?) в спектре АЦП.
Надо разделить тактовые АЦП и другие тактовые.

Гетеродин надо разводить во внутренних слоях
чтобы не наводился на вход АЦП


сигнал SEL_ETALON_3V3 на мезанине никуда не идёт!!! по удаче он внутри притянут к нулю
и подключён вход 0

16-10-2019
----------
сигнал Encode - постоянно запитан еденицей.


11-10-2019
----------

~0 SW_init;
~0 test:1;
~0 upr_at1:60;


номера каналов : 1 и 2!!!



Запустить прогу в CodeBlocks (PCI_1->pj1_work)
Запустить прогу в Visual Studio (fft_writer)
увидеть в консоли :
---------------
init_LANE
wait LINK 1,2
---------------
запустить  ~0 SW_init; в консоли на поделке

в консоле компа должно появиться:
STATUS [7:5]:5
STATUS [7:5]:5
STATUS [7:5]:5
STATUS [7:5]:5

в консоле поделки:

Run
Link0:established
Run
Link1:established
stage 1
stage 2
Run
Run
соединение установлено!!!
SPACEWIRE UP!

Если не удалось то:
перезапустить поделку
перезапустить прогу на ПК (PCI_1->pj1_work)

и всё заново.

27-09-2019
----------
В процессоре 15Ф только одно DMA для SW
и по этому данные передаются последовательно сначала в один канал потом в другой.

Внутри массива из 1024 отсчётов были (на краях) куски других временных рамок, из-за этого были скачи по фазе рядом с основной 
гармоникой.
Причём косяк был как в прошивке поделки - там мы скачивали старые данные зи фифо , пришлось увеличить смещение
до 1024 отсчётов (так как передаётся сразу два канала 2*512) .
Так была ошибка и на компе = СOL+1 и цикл не с нуля а с еденицы, лишние данные были на конце массива.

-----------------------------------------------------------------------------
Вижу зеркалку на спектре - это может быть из-за неортогональности квадратур,
кстати на графике timeseries это выражается в амплитудной модуляции сигнала по видимому.



24-09-2019
----------
В программе Hercules SETUP
при работе с UDP
на одном компе
в IP пишем локальный адресс 127.0.0.1
Port: - пишем порт сервера куда отсылаем данные
local port - какой-то другой порт

20-09-2019
----------
Вопросы Элвису:
1. Почему можно передать только 32 слова по 4 байта ,
 а если передать больше то данные теряются и смешиваются из разных каналов?

Чтобы компилился проект сервера на си:
надо в настройках компилятора подключить либу: libws2_32.a



19-09-2019
----------
скорость 115200
Для проверки спасеваре:
запустить программу на ПК
запустить  ~0 SW_init;  на поделке

смотреть файл записи.




11-09-2019
----------
Первом прототипе есть какая-то комбинация с сигналами синхронизации микрухи 1288, разобраться!!!
а то на новой оснастке 1288 не запускается.

замерили питание при раздельном питании:

прототип 		- 1.7  А (5  В)
оснастка с мезанином	- 0.78 А (12 В)

При питании от 12 Вольт - 2.6 Ампер (всё вместе)
!!! по видимому перегревается линейный стабилизатор оснастки!!!
по 5-ти вольтам , 
 
10-09-2019
----------
У мезанина свой кабель питания чёрный с красным, но не на 24 Вольта!!!
косяк в схеме соеденения мезанинной платы и оснастки
на оснастке выходит rs485 а на мезанине принимается обычный уарт!!!

Надо:

на оснастке снять DD15,R61,R63 
соединить контактные площадки  1 - 6 и 4 - 7 посадочного места микросхемы DD15

Потребление новой связки:
Прототип старый - новая оснастка - новый мезонин = 1.92 А (12 В)

Потребление прототипа:1А


29-08-2019
----------
Пример работы между компом и отладкой по шине spacewire
комп и отладка соеденены двумяф кабелями , на компе это средние два порта.
Сначала запускаем программу на компе, убеждаемся что она видит карту элвиса и тестируетеё.
потом компилим прогу на отладке и подключаем jtag.
Потом жмём ввод на компе и после этого у нас есть 10 секунд на то чтобы запустить программу на отладке 

при этом в терминале на компе должны появиться данные о соеденении с отладкой

и послать команду:


~0 SW_tx:1;  - в терминале

на компе по истечении 10 секунд выведутся принятые данные.

28-08-2019
----------
Почему-то м54 не любит функцию Delay_ms() ??? - влияние на обработку!!!
Иногда глючит АЦП , толи из-за кривой калибровки толи при старте.


28-08-2019
----------
PCI карта работает если поставить старые драйвера из архива:
mcb_pci_driver_win

30-07-2019
-----------
http://sicmit.ru/produktsija/programmnoe-obespechenie/
Мост Ethernet-SpaceWire


18-07-2019
----------
Найдена ошибка в схеме прототипа.
Для работы SPI 1288 , нужно на вход PCLK подавать частоту.
Завели туда 100 МГЦ.
Заработало.

16-08-2019
----------
1. Готовим загрузчик из проекта elfloader
правим main.s 
-строка 112 - стартовый адрес ELF объекта (основная прошивка) , адрес логический в пространстве адресов процессора но расположенный во флеш ElfObjectPtr = 0xbfc00800
у нашей флешки только 19 адресных бит и  мы старшие 0xbfc.... не различаем потому видим от нуля и выше, в нулевом адресе располагаем
стартовый загрузчик который разбирает elf файл (самый большой файл рабочего проекта с его именем и расширением *.o )

готовим файлы для прошивки во флешку:

srec_cat test.bin -binary -o z.hex -intel        //готовим загрузчик в формате hex
srec_cat tfc11_swic.o -binary -o main.hex -intel //готовим прошивку  в формате hex
srec_cat z.hex -intel main.hex -intel -offset 0x800 -o x.hex -intel //сливаем загрузчик и прошивку , смещая прошивку на адрес 0х800

Зашиваем во флеш файл x.hex с нулевого адреса программой ProgFLASH.exe через программатором флеш
!!! сначала включаем программу ProgFLASH.exe !!!
и лишь затем программатор.

у нас тоит флеш 1636PP3У

~0 upr_at1:10;

~0 resiver:1;

08-08-2019
----------
Как оказалось был выключен второй логический канал и мы используя в приёмном массиве данные через отсчёт, непроизвольно 
децимировали сигнал.

CIC фильтр:
порядок это     - differential delay
степень фильтра - filter order

cic_fir.m - расчёт корректирующего фир фильтра


06-08-2019
----------
При обединении каналов в 1288 , CIC включается только в одном канале.


05-08-2019
----------
поменял фазу сигнала CLK подаваемого на 1288
посадил на "ноль" ножки 
126,127,128 и 194,195,196 - шина IDAT1 и IDAT3


02-08-2019
----------
Ошибка:
неправильно подключена шина данных 
АЦп к DSP , надо было старшие разряды к старшим разрядам подключать
а теперь судя по всему динамический диапазон снижен в 4 раза и появиться постоянная состовляющая

Были не подтянуты входы:
sync_clr и прочие к нулю, в результате на них что-то наводилось и проц DSP 
глючил.

сигнал Encode - постоянно запитан еденицей.

25-07-2019
----------
Чтобы DSP 1288 заработала - нужно включить АЦП для подачи тактов на DSP

~0 adc:1;   //включение АЦП
~0 spi_r:3; //проверка DSP

Выход АЦП - offset binary

пока будем работать с 1288 от одного АЦП (1)

16-07-2019
----------
На АЦП к5101НВ015  надо подавать такты с уровнем не менее!!! 1.4Вольта p-p

на смеситель надо подавать уровень не менее 0 Дбм (200 мВ)

15-07-2019
----------
Из косяков:
Не работал уарт  - потому что не было 
электрического контакта на приспособлении , между ним и прототипом.

Перепутал знак меньше со знаком сдвинуть < и << .

На микросхеме DD10 ощибки сигналов DIR и NOE


1. у нас проблема с размерами конденсаторов на прототипе и трансофрматорами!!!

09-07-2019
----------
Фапчи были не в захвате потому что
ПИФ фильтры были расчитаны и запаяны неправильно!!!

R80 = 560 R
C84 = 3900 pF
C85 = 47 pF

20-06-2019
----------
Частота PLL DD12 - 2500 МГц
ФАПЧ-Б

Частота PLL DD12 - 2520 МГц
ФАПЧ-А


19-06-2019
----------
 init_SPI2(void) // spi для LMK
 init_SPI1(void) //spi который идёт на компьютерную плату - будет слейвом

ошибка в схеме мезанина - не заведён сигнал SEL_ETALON_3V3 , заведём его перемычкой на R50 (PA8)!!!


10-07-2019
----------
FIR с антисимметричной характеристикой это фильтр ФВЧ , он не пропускает постоянную составляющую и
на нём делают преобразователь гилберта.

Возможно что у нас проблема с сигналом ENCODE !!!

09-07-2019
----------
Были перекрещены сигналы уарта в прототипе и заведены на уарт1 вместо уарт0
Надо поменять обозначение на печатной плате прототипа.

Также сделали - поменяли местами сигналы в кабеле по которому оснастка соеденена с мезанином (кабель питания и уарта)
Также на плате мезанина фапч-и не в захвате, нет ПИФ фильтров.
Надо их перепаять.

Занимаюсь программированием 1288 , составляю структуру её регистров.

Наш прототип не программировался по джитагу программатором , пока мы не подключили программатор к отладочной плате.
Не смог сделать отдельные файлы в проекте для прототипа, пришлось всё пихать в мейн.с


04-07-2019
----------
Проблемы с передачей 10 Мгц через кабель


08-05-2019
----------
Проекты:
МС3 - MCStudio 3M c:\MCStudio_3M\Projects\UART_echo\
МС4 - MCStudio 4M c:\elvees\MCStudio4_DEMO_2019.03_167\workspace\M54\


22-04-2019
----------
Чтобы запустить прошивку на MCStudio 4
надо:
из папки с прошивкой в окне консоли enhanced console 
запустить mdb.exe (предварительно скопировав в папку)
если всё хорошо то он найдёт программатор и плату.
потом набрать reset
скопировать из среды набор параметров set для отладочной платы
потом:
loadelf UART_echo.elf или UART_echo.o
потом:
run


22-11-2018
----------
из приложения по закупкам нам не надо:
1,2,13,




09-04-2018
----------
Внёс поправки в схему отладочной платы, надо оттранслировать!!!


04-04-2018
-----------
Пришлось изменить расстояние до составляющих модуля печатных плат
(удлинить)

Внёс изминение в схему модуля - завёл тактовый сигнал на 
40 вход DD1 1288 c второго АЦП .
Чтобы не тащить 100 Мгц в КМОПе из-вне.


23-03-2018
----------
1. Разработка электрической структурной схемы приёмного модуля
2. Выбор элементной базы для приёмного модуля
3. Разработка эскиза конструкции модуля и его составных частей - 1 этап
4. Разработка электрической функциональной схемы приёмного модуля - 1 этап




----------------------------------------------------------
1 разработка принципиальной схемы узла питания приёмного модуля

2 трассировка в САПР части печатной платы узла питания приёмного модуля

3 разработка перечня элементов в части узла питания приёмного модуля

4.Разработка эскиза конструкции узла питания приёмного модуля

Диод для питания

2ДШ2124А94
Сделал  этот элемент для каденса - назвал kt-93, в честь корпуса.
рад стойкость 7И - 2Ус

14-03-2018
-----------

1НТ251А21
Радиационно-стойкие
Транзисторные матрицы
4 n-p-n транзистора
